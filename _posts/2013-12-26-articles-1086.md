---
layout: post
title: EbisuConnectionにスレーブ自動切り離し機能をつけました
date: 2013-12-26 12:40:00 +0900
author: Tsukasa OISHI
permalink: /articles/1086
---

FreshConnection(ver.0.1.7)に、スレーブへのアクセス時に発生した例外をキャッチできる機能をつけました。

ロードバランサを使っている場合は、スレーブ群の一台が死んだときの対処を考える必要があまりないと思いますが、EbisuConnectionのようにスレーブそれぞれとコネクションをはりっぱなしにしていると、一台が死んだだけでサービスに影響が出てしまいます。

そこでFreshConnectionの例外キャッチ機能を使って、死んだスレーブをスレーブ群から自動で切り離し、リトライを実行する機能をEbisuConnection(ver.0.0.4)に追加しました。これでスレーブが突然死んでも困るような事態にはならないと思います。

ちなみに死んだスレーブが復活しても、EbisuConnectionはそのスレーブへのコネクションを自動で復旧したりはしません。スレーブ群のひとつとして復旧させたい場合は、config/slave.yamlにtouchしてください。
そのときは、重み付けを低くしておくと、ちょっとずつ暖気ができて便利だったりします。

