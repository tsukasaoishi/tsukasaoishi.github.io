---
layout: post
title: MiyazakiResistance0.1.4リリース。TTへのコネクションまわりの挙動を変更しました
date: 2009-11-15 01:01:49 +0900
author: Tsukasa OISHI
permalink: /articles/780
---

MiyazakiResistanceのバージョンを0.1.4にアップしました。
今回の変更点は、以下のとおりです。

■必要になったときにはじめて、TTへのコネクションがはられるようになりました
RailsなどでMRを使っていると、TTへのアクセスを行わないプロセスからも(機能別にわけたmongrelやバッチ、consoleなど)、無駄にコネクションがはられていました。このことが原因で、TTサーバの最大ファイルディスクリプタ数を超えるという事態になったりして困りました。fd数の上限をあげればいいのですが、そもそも無駄にコネクションをはってリソースを消費することもありません。

■デュアルマスタ構成の場合、スタンバイサーバからの読み込みを行わないようにしました
今までは、デュアルマスタ構成のとき、スタンバイサーバへも読み込みは行っていました。TTはもともと一台のサーバでも十分に処理をまわせるポテンシャルを持っているし、スタンバイサーバなのに稼働しているというのもおかしな気もするので、一切のアクセスを行わないようにしました。
もちろん、アクティブサーバーが落ちたときは、スタンバイサーバーがアクティブに昇格するのは今まで通りです。

■タイムアウトのデフォルト値を5秒に変更しました
以前は60秒だったのですが、いくらなんでも長すぎるので…。本当は5秒でも長いと思いますが。

それから、今回からgemの公開はgemcutterを使用するようにしました。
インストールは以下のコマンドで実行できます。

```ruby
gem install miyazakiresistance
```

gemcutterをインストールしていない人はまず先に下記のコマンドを実行する必要があります。
gemの探索先にGemcutter.orgを追加するだけでもOKです。

```ruby
gem install gemcutter
gem tumble
```
